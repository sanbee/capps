<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="applycal" category="calibration">
<shortdescription>Apply calibrations solutions(s) to data</shortdescription>
<description>
Applycal reads the specified gain calibration tables, applies
them to the (raw) data column (with the specified selection),
and writes the calibrated results into the corrected column.
This is done in one step, so all available calibration must
be specified.  Applycal will overwrite existing corrected data.

Standard data selection is supported.  See help par.selectdata
for more information.

One or more calibration tables (both temporal, frequency, polarization
calibrations) can be specified in the gaintable parameter.  The
calibration values associated with a restricted list of fields
can also be selected for each table.

See task accum for instructions on forming calibration
incrementally.  See task split for saving corrected data in
another visibility file.

</description>
<input>
	<param type="string" name="vis" mustexist="true">
		<description>Name of input visibility file</description>
		<value></value>
	</param>

	<param type="string" name="field">
		<description>Select field using field id(s) or field name(s)</description>
		<value></value>
	</param>

	<param type="string" name="spw">
		<description>Select spectral window/channels</description>
		<value></value>
	</param>

	<param type="bool" name="selectdata">
		<description>Other data selection parameters</description>
		<value>True</value>
	</param>

	<param type="string" name="timerange" subparam="true">
		<description>Select data based on time range</description>
		<value></value>
	</param>

	<param type="any" name="uvrange" subparam="true">
		<description>Select data within uvrange (default units meters)</description>
		<any type="variant"/>
		<value type="string"></value>
	</param>

	<param type="string" name="antenna" subparam="true">
		<description>Select data based on antenna/baseline</description>
		<value></value>
	</param>

	<param type="string" name="scan" subparam="true">
		<description>Scan number range</description>
		<value></value>
	</param>

	<param type="string" name="msselect" subparam="true">
		<description>Optional complex data selection (ignore for now)</description>
		<value></value>
	</param>

	<param type="stringArray" name="gaintable">
		<description>Gain calibration table(s) to apply on the fly</description>
		<value></value>
	</param>

	<param type="stringArray" name="gainfield">
		<description>Select a subset of calibrators from gaintable(s)</description>
		<value></value>
	</param>

	<param type="stringArray" name="interp">
		<description>Temporal Interpolation type.  default=linear</description>
		<value></value>
		<allowed kind="enum">
			<value>nearest</value>
			<value>linear</value>
			<value>aipslin</value>
			<value></value>
		</allowed>
	</param>

	<param type="intArray" name="spwmap">
		<description>Spectral windows combinations to form for gaintables(s)</description>
		<value></value>
	</param>

	<param type="bool" name="gaincurve">
		<description>Apply internal VLA antenna gain curve correction</description>
		<value>False</value>
	</param>

	<param type="double" name="opacity">
		<description>Opacity correction to apply (nepers)</description>
		<value>0.0</value>
	</param>
	<param type="bool" name="parang">
		<description>Apply parallactic angle correction</description>
		<value>False</value>
	</param>

	<param type="bool" name="calwt">
		<description>Calibrate data weights from all relevant calibrations</description>
		<value>True</value>
	</param>

   <constraints>
	<when param="selectdata">
		<equals type="bool" value="True">
			<default param="timerange"><value type="string"/></default>
			<default param="uvrange"><value type="string"/></default>
			<default param="antenna"><value type="string"/></default>
			<default param="scan"><value type="string"/></default>
			<default param="msselect"><value type="string"/></default>
		</equals>
		<equals type="bool" value="False"/>
	</when>
   </constraints>
</input>
<example>


       Applycal reads the specified gain calibration tables, applies
       them to the (raw) data column (with the specified selection),
       and writes the calibrated results into the corrected column.
       This is done in one step, so all available calibration tables must
       be specified.  Include parang, gaincurve, opacity is used in
       obtaining previous calibration tables.

       Applycal will overwrite existing corrected data.

       All calibration tables (both temporal, frequency, polarization
       calibrations) are specified in the gaintable parameter.  The
       calibration values associated with a restricted list of fields
       can also be selected for each table in gainfield

       See task accum for instructions on forming calibration
       incrementally.  See task split for copying out any portion of the data
       and selected columns to a new visibility file.

       Keyword arguments:
       vis -- Name of input visibility file
               default: &lt; none&gt;; example: vis='ngc5921.ms'

      --- Data Selection: the data to which the calibration will be applied
        (see help par.selectdata for more detailed information)

      field -- Select field id(s) or field name(s) to apply calibration.
                 [run listobs to obtain the list id's or names]
              default: ''=all fields
              If field's string is an integer &gt;=0, it is assumed to be an index
                otherwise, it is assumed to be a field name
              field='0~2'; field ids 0,1,2
              field='0,4,5~7'; field ids 0,4,5,6,7
              field='3C286,3C295'; fields named 3C286 and 3C295
              field = '3,4C*'; field id 3, all names starting with 4C
     spw -- Select spectral window/channels 
               type 'help par.selection' for more examples.
             spw='0~2,4'; spectral windows 0,1,2,4 (all channels)
             spw='&lt;2';  spectral windows less than 2 (i.e. 0,1)
             spw='0:5~61'; spw 0, channels 5 to 61, INCLUSIVE
             spw='*:5~61'; all spw with channels 5 to 62
             spw='0,10,3:3~45'; spw 0,10 all channels, spw 3, channels 3 to 45.
             spw='0~2:2~6'; spw 0,1,2 with channels 2 through 6 in each.
             spw='0:0~10;15~60'; spectral window 0 with channels 0-10,15-60
                       NOTE ';' to separate channel selections
             spw='0:0~10^2,1:20~30^5'; spw 0, channels 0,2,4,6,8,10,
                   spw 1, channels 20,25,30
      selectdata -- Other data selection parameters
              default: True
      timerange  -- Select data based on time range:
              default = '' (all); examples,
              timerange = 'YYYY/MM/DD/hh:mm:ss~YYYY/MM/DD/hh:mm:ss'
              Note: if YYYY/MM/DD is missing, date defaults to first day in
                    data set
              timerange='09:14:0~09:54:0' picks 40 min on first day
              timerange= '25:00:00~27:30:00' picks 1 hr to 3 hr 30min on next day
              timerange='09:44:00' data within one integration of time
              timerange='&gt;10:24:00' data after this time
      uvrange -- Select data within uvrange (default units meters)
              default: '' (all); example:
              uvrange='0~1000kl'; uvrange from 0-1000 kilo-lambda
              uvrange='&gt;4kl';uvranges greater than 4 kilolambda
      antenna -- Select data based on antenna/baseline
              default: '' (all)
              If antenna's string is an integer &gt;=0, it is taken to be an index
                otherwise, it is assumed to be an antenna name
              antenna='5&amp;6'; baseline between antenna index 5 and index 6.
              antenna='VA05&amp;VA06'; baseline between VLA antenna 5 and 6.
              antenna='5&amp;6;7&amp;8'; baseline 5-6 and 7-8
              antenna='5'; all baselines with antenna index 5
              antenna='05'; all baselines with antenna name 05--vla antenna 5.
              antenna='5,6,10'; all baselines with antennas 5,6 and 10
      scan -- Scan number range
      msselect -- Optional complex data selection (ignore for now)

       --- Calibration files to apply
       gaintable -- Gain calibration table(s) to apply 
               default: '' (none);
               examples: gaintable='ngc5921.gcal'
                   gaintable=['n5921.ampcal','n5921.phcal','n5921.bpass']
               All gain table types: 'G', GSPLINE, 'T', 'B', 'BPOLY', 'D's'
                   can be applied.
       gainfield -- Select a subset of calibrators from each gaintable
               default:'' ==&gt; all sources in table;
               same syntax as field
               example: gainfield='0~3'
                        gainfield=['0~3','4~6']  (for multiple gaintables)
       interp -- Interpolation mode (in time) to use for each gaintable
                default: '' --&gt; 'linear' for all gaintable(s)
                example: interp='nearest'
                         interp=['nearest','linear']  (for multiple gaintables)
                Options: 'nearest', 'linear', 'aipslin'
       spwmap -- Spectral windows combinations to form for gaintable(s)
               default: [] (apply solutions from each spw to that spw only)
               Example:  spwmap=[0,0,1,1] means apply the caltable solutions
                         from spw = 0 to the spw 0,1 and spw 1 to spw 2,3.
                         spwmap=[[0,0,1,1],[0,1,0,1]]  (for multiple gaintables)
                         
          Complicated example:

            gaintable=['tab1','tab2','tab3']
            gainfield='3C286'
            interp=['linear','nearest']
            spwmap=[[],[0,0,2]]
            
            This means: apply 3 cal tables, selecting only solutions for 3C286
            from tab1 (but all fields from tab2 and tab3, indicated by
            no gainfield entry for these files).  Linear interpolation
            (in time) will be used for 'tab1' and 'tab3' (default); 'tab2' will
            use nearest.  For the 'tab2', the calibration spws map
            will be mapped to the data spws according to 0-&gt;0, 0-&gt;1, 2-&gt;2.
            (I.e., for data spw=0 and 2, the spw mapping is one to one,
            but data spw 1 will be calibrated by solutions from spw 0.)  
           
       gaincurve -- Apply internal VLA antenna gain curve correction (True/False)
               default: False;
               Use gaincurve=True ONLY for VLA data
       opacity -- Opacity correction to apply (nepers)
               default: 0.0 (no opacity correction)
               example: opacity=0.051
               Typical VLA values are: 5 GHz - 0.013, 8 GHz - 0.013
               15 GHz - 0.016, 23 GHz - 0.051, 43 GHz - 0.07
       parang -- If True, apply the parallactic angle correction.  FOR ANY
               POLARIZATION CALIBRATION AND IMAGING, parang = True
               default: False
       calwt -- Calibrate weights along with data for all
               relevant calibrations
               default: True; example: calwt=False
       async -- Run task in a separate process 
                default: False; example: async=True


</example> 

</task>
</casaxml>
