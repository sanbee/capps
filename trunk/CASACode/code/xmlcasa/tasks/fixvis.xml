<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>

<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<!-- Documentation here.                                                -->

<task type="function" name="fixvis" category="data editing, utility" visibility="experimental">

<shortdescription>Recalculates or converts (u, v, w)<!--  and Changes Phase Center. --></shortdescription>
<description>
     This corrects visibilities, and/or their (u, v, w) positions, for various
     effects that can be calculated without fitting a model to the data.

     The effects include:
     \begin{itemize}
       \item calculating (u, v, w) coordinates,
<!--        \item changing the phase tracking center(s),
       \item correcting for differential aberration,  -->
       \item changing the refcode (i.e. B1950 to J2000, etc.),
<!--        \item changing the projection, as in (-)NCP to SIN,  -->
       \item refocusing (Not yet incorporated).
     \end{itemize}
</description>

<input>
    <param type="string" name="vis" kind="ms" mustexist="true">
        <description>Name of the input visibility set.</description>
        <value></value>
        <example>vis='ngc5921.ms'</example>
    </param>
    <param type="string" name="outputvis" kind="ms">
        <description>Name of the output visibility set.  (Can be the same as vis.)</description>
        <value></value>
        <example>vis='ngc5921\_fixedvis.ms'</example>
    </param>
    <param type="any" direction="in" name="fields">
      <description>Fields to operate on.  Blank = all.</description>
      <any type="variant"/>
      <value>""</value>
    </param>
    <param type="string" name="refcode">
      <!-- Don't wrap! -->
        <description>Reference frame to use for outputvis.  WARNING: clean and the im tool ignore the reference frame claimed by the UVW column (it is often mislabelled as ITRF when it is really J2000) and instead assume the (u, v, w)s are in the same frame as the phase tracking center.  fixvis does not yet force the UVW column and field centers to use the same reference frame!  Blank = use the phase tracking frame of vis.</description>
        <value></value>
        <example>refcode = 'B1950_VLA'</example>
    </param>
    <param type="bool" name="reuse">
      <description>Start from the UVWs in vis (True) or calculate them from the antenna positions?</description>
      <value>True</value>
    </param>
<!--     <param type="string" name="proj">
        <description>Projection code to use for the output.</description>
        <value></value>
        <example>proj = 'SIN'</example>
    </param>  -->
<!--     <param type="any" direction="in" name="phasecenters">
        <description>Phase tracking centers to use for the output, in the same order as fields.  Use LON LAT offsets (i.e. "-0.5s 0.5s") in the same frame as refcode or absolute directions (i.e. "J2000 19h55m05.6s -34d44m43.0s"). Blank = use old ones.</description>
	<any type="variant"/>
        <value>""</value>
        <example></example>
    </param>  -->
</input>

<!-- DIRTY HACK: <description> does not currently (2009-03-10) make it into help or ?,
                 but <example> does. -->
<!-- <description> -->
<example>

This task calculates (u, v, w) coordinates, and optionally changes the
reference frame (i.e. B1950_VLA to J2000 and back).

Not yet implemented, or incorporated in this task, are:
   changing the phase tracking center(s),
   changing the projection (i.e SIN to or from (-)NCP).
   correcting for differential aberration,
   adjusting antenna positions,
   fixing clock errors,
   and refocusing to a finite distance.

Input Parameters:

vis       --- Name of input measurement set.
              ex: vis='my.ms'

outputvis --- Name of the output measurement set.  (Can be the same as vis.)
              ex: outputvis = 'myrefocused.ms'

fields    --- Selection string for the fields to operate on.  '' = all.

refcode   --- Reference frame to use for the generated (u, v, w)s,
              i.e. 'J2000', 'B1950', 'GALACTIC', etc..  A full list of
              codes can be gotten from
              'csys=cs.newcoordsys(True);csys.referencecode('dir',True);csys.done()'

              The reference frame cannot be changed when only some of the
              fields are selected.

              Default: '' (use the reference frame of the phase tracking
                           center(s) in the input ms)

              ex: refcode = 'B1950_VLA'

              WARNING: clean and the im tool ignore the reference frame
              claimed by the UVW column (it is often mislabelled as ITRF
              when it is really J2000) and instead assume the (u, v, w)s
              are in the same frame as the phase tracking center(s) of the
              MS.  fixvis does not yet force the UVWs and fields to use the
              same frame!

reuse     --- If True, start from the UVWs in vis, e.g. rotate them for an
              equinox conversion.  Otherwise, freshly calculate them from
              the antenna positions.

              Set to True if you think fixvis will produce more accurate UVWs
              than the ones in vis.  (Depends on when and where the observation
              was made and/or filled.)

              Default: True

<!-- proj       Projection code to use for the output.  A list of codes can be
              gotten from 'csys = cs.newcoordsys(True);csys.projection('all');csys.done()'
              Cannot be changed when only some of the fields are selected.
              Default '' = projection of input ms.
              ex: proj = 'TAN' -->

<!-- </description> -->

<!-- <example> -->
Example:

fixvis(vis='my.ms', outputvis='myrefocused.ms', refcode='J2000', reuse=False)

</example>

</task>

</casaxml>
