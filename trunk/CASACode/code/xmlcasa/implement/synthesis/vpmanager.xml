<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">
 
        <tool name="vpmanager" module="imager">


<code>
        <include>xmlcasa/synthesis/vpmanager_forward.h</include>
<private>
        #include &lt;xmlcasa/synthesis/vpmanager_private.h&gt;
</private>

</code>

        <shortdescription>Tool for specifying voltage patterns and primary beams</shortdescription>
       

<description>
The vpmanager, or voltage pattern manager, creates a table with the
description of one or more voltage patterns (vp) or primary beams
(pb).  There is a mapping between telescope name and the vp or pb
description.  The vp description table can be read by imager's
<link anchor="imager:imager.setvp.function">setvp</link> method, which instantiates the
corresponding voltage patterns from the descriptions and applies them
to the images.  While the vp description table can have multiple
telescopes in it, limitations to the internal visibility buffers
currently limit the functionality within imager to a single telescope.
<!-- </description> -->

\subsubsection*{What {\tt vpmanager} does:}

\begin{description}
\item[Set a Given Telescope's VP/PB model] The vpmanager recognizes the
names of several telescopes: ATCA, GBT, GMRT, HATCREEK, NMA, NRAO12M,
NRAO140FT, OVRO, VLA, WSRT.  New telescopes and their default VP/PB models will
need to be added to the system.

\item[Common VP/PB Models] Many common voltage pattern (vp) and primary beam (pb)
models have been coded into \casa.  Currently, the recognized models include
DEFAULT, ATCA\_L1, ATCA\_L2, ATCA\_L3, ATCA\_S, ATCA\_C, ATCA\_X, GBT, GMRT,
HATCREEK, NRAO12M, NRAO140FT, OVRO, VLA, VLA\_INVERSE, VLA\_NVSS,
VLA\_2NULL, VLA\_4, VLA\_P, VLA\_L, VLA\_C, VLA\_X, VLA\_U, VLA\_K, VLA\_Q,
WSRT, and WSRT\_LOW.  In all cases, the VP/PB model and the beam squint (if
present) scale linearly with wavelength.  If DEFAULT is selected, the
appropriate VP/PB model is selected for the telescope and observing frequency.
\item[1-D Beam Models] Most beam models are rotationally symmetric (excepting
beam squint).  From the beam parameterization in terms of the various
coefficients and other terms, an internal lookup table with 10000 elements is
created for application of the VP/PB to an image.

\item[Beam Squint] The VP/PB models include beam squint.  The VLA\_L,
VLA\_C, VLA\_X, VLA\_U, VLA\_K, and VLA\_Q models (which are the defaults for
those VLA bands), have the appropriate squint magnitude and orientation, though
the orientation has not been verified through processing actual data.
\item[Multiple VP/PB Models for one MS] The VPManager can have VP information
for multiple telescopes.  However, the internals of imager cannot yet deal with
VP/PB's for multiple telescopes.  In the case of a MS with multiple
telescopes present, the primary beam of the first telescope present in
the MS will be used, even if it is not the first telescope specified
in the VP description table produced by vpmanager.

\item[Antenna-dependent Voltage Patterns] are not yet supported.

\item[Two-dimensional Voltage Pattern Images] are supported via
<link anchor="synthesis:imager.vpmanager.setpbimage.function">setpbimage</link>.
\end{description}

</description>

<example>
The following example shows a simple way to make
a new voltage pattern table.

Note that this can be more easily
done from the <link anchor="tasking:toolmanager">toolmanager</link>.
\begin{verbatim}
"""
#
# make the vpmanager
#
vptool = casac.homefinder.find_home_by_name('vpmanagerHome')
vp =vptool.create()
#
# Lets say we want an Airy Disk voltage pattern for our
# HATCREEK data, but we want to use the system default
# for the OVRO data:
#
vp.setpbairy(telescope='HATCREEK', dopb=T, dishdiam='6.0m',
             blockagediam='0.6m',  maxrad='2arcmin',
             reffreq='100GHz', dosquint=F)
#
vp.setcannedpb(telescope='OVRO', dopb=T, commonpb='DEFAULT', dosquint=F)
#
vp.summarizevps()
#
vp.saveastable(tablename='California.Beaming')
#
print "Last example.  Exiting..."
exit()
"""
\end{verbatim}
</example>


 
   <method type="constructor" name="vpmanager">
   <shortdescription>Construct a vpmanager tool</shortdescription>
   
<description>
The vpmanager constructor has no arguments.
</description>
</method>

 
   <method type="function" name="saveastable">
   <shortdescription>Save the vp or pb descriptions as a table</shortdescription>
   
<description>
Save the vp or pb descriptions as a table.  Each description is in a different
row of the table.
</description>
<input>

     <param type="string" name="tablename">
     <description>Name of table to save vp descriptions in</description>
     <value></value>
     </param>
</input>
<returns type="bool"></returns>
</method>

 
   <method type="function" name="summarizevps">
   <shortdescription>Summarize the currently accumulated VP descriptions</shortdescription>
   
<description>
Summarize the currently accumulated VP descriptions to the logger.
</description>
<input>

     <param type="bool" name="verbose">
     <description>Print out full record?  Otherwise, print summary.</description>
     <value>false</value>
     </param>
</input>
<returns type="bool"></returns>
</method>

 
   <method type="function" name="done">
   <shortdescription>Terminate the vpmanager</shortdescription>
   
<description>
Eliminate the current vpmanager.
</description>
<returns type="bool"></returns>
</method>

 
   <method type="function" name="setcannedpb">
   <shortdescription>Select a vp/pb from our library of common pb models</shortdescription>
   
<description>
We have many vp/pb models ready to go for a variety of telescopes.  If 'DEFAULT' isselected, the system default for that telescope and frequency is used.
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="string" name="commonpb">
     <description>List of common vp/pb models: DEFAULT code figures it out</description>
     <value>DEFAULT</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbairy">
   <shortdescription>Make an airy disk vp</shortdescription>
   
<description>
Information sufficient to create a portion of the Airy disk voltage pattern.
The Airy disk pattern is formed by Fourier transforming a uniformly illuminated
aperture and is given by
\begin{equation}
vp_p(i) = ( areaRatio * 2.0 * j_{1}(x)/x 
                  - 2.0 * j_{1}(x*lengthRatio)/(x*lengthRatio) )/ areaNorm,
\end{equation}
where areaRatio is the dish area divided by the blockage area, lengthRatio
is the dish diameter divided by the blockage diameter, and 
\begin{equation}
x = \frac{i * maxrad * 7.016 * dishdiam/24.5m}{N_{samples} * 1.566 * 60}.
\end{equation}
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="any" name="dishdiam">
     <description>Effective diameter of dish</description>
     <any type="variant"/>
     <value>25.0m</value>
     </param>

     <param type="any" name="blockagediam">
     <description>Effective diameter of subreflector blockage</description>
     <any type="variant"/>
     <value>2.5m</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/>
     <value>0.8deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbcospoly">
   <shortdescription>Make a vp/pb from a polynomial of scaled cosines</shortdescription>
   
<description>
A voltage pattern or primary beam of the form
\begin{equation}
VP(x) = \sum_{i} ( coeff_{i} \cos^{2i}( scale_{i} x).
\end{equation}
This is a generalization of the WSRT primary beam model.
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="doubleArray" name="coeff">
     <description>Vector of coefficients of cosines</description>
     <value>-1</value>
     </param>

     <param type="doubleArray" name="scale">
     <description>Vector of scale factors of cosines</description>
     <value>-1</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/>
     <value>0.8deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="string" name="isthispb">
     <description>Do these parameters describe a PB or a VP?</description>
     <value>PB</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbgauss">
   <shortdescription>Make a Gaussian vp/pb</shortdescription>
   
<description>
Make a Gaussian primary beam given by
\begin{equation}
PB(x) =  e^{- (x/(halfwidth*\sqrt{1/\log(2)})) }.
\end{equation}
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="any" name="halfwidth">
     <description>Half power half width of the Gaussian at the reffreq</description>
     <any type="variant"/>
     <value>0.5deg</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/>
     <value>1.0deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="string" name="isthispb">
     <description>Do these parameters describe a PB or a VP?</description>
     <value>PB</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbinvpoly">
   <shortdescription>Make a vp/pb as an inverse polynomial</shortdescription>
   
<description>
The inverse polynomial describes the inverse of the VP or PB
as a polynomial of even powers:
\begin{equation}
1/VP(x) = \sum_{i} coeff_{i} * x^{2i}.
\end{equation}
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="doubleArray" name="coeff">
     <description>Coefficients of even powered terms</description>
     <value>-1</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/> 
     <value>0.8deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="string" name="isthispb">
     <description>Do these parameters describe a PB or a VP?</description>
     <value>PB</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbnumeric">
   <shortdescription>Make a vp/pb from a user-supplied vector</shortdescription>
   
<description>
Supply a vector of vp/pb sample values taken on a regular grid between x=0 and
x=maxrad.  We perform sinc interpolation to fill in the lookup table.
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="doubleArray" name="vect">
     <description>Vector of vp/pb samples uniformly spaced from 0 to maxrad</description>
     <value>-1</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/>
     <value>0.8deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="string" name="isthispb">
     <description>Do these parameters describe a PB or a VP?</description>
     <value>PB</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720deg</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbimage">
   <shortdescription>Make a vp/pb from a user-supplied image</shortdescription>
   
<description>
Experimental: Supply an image of the E Jones elements. The format of the 
image is:
\begin{description}
\item[Shape] nx by ny by 4 complex polarizations (RR, RL, LR, LL or
XX, XY, YX, YY) by 1 channel.
\item[Direction coordinate] Az, El
\item[Stokes coordinate] All four ``stokes'' parameters must be present
in the sequence RR, RL, LR, LL or XX, XY, YX, YY.
\item[Frequency] Only one channel is currently needed - frequency 
dependence beyond that is ignored. 
\end{description}
One or two images may be specified - the real (must be present) and
imaginary parts (optional). 

Note that beamsquint must be intrinsic to the images themselves.
This will be accounted for correctly by regridding of the images
from Az-El to Ra-Dec according to the parallactic angle.

</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="string" name="realimage">
     <description>Real part of vp as an image</description>
     <value></value>
     </param>

     <param type="string" name="imagimage">
     <description>Imaginary part of vp as an image</description>
     <value></value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

 
   <method type="function" name="setpbpoly">
   <shortdescription>Make a vp/pb from a polynomial</shortdescription>
   
<description>
The VP or PB is described as a polynomial of even powers:
\begin{equation}
VP(x) = \sum_{i} coeff_{i} * x^{2i}.
\end{equation}
</description>
<input>

     <param type="string" name="telescope">
     <description>Which telescope in the MS will use this vp/pb?</description>
     <value>VLA</value>
     </param>

     <param type="string" name="othertelescope">
     <description>If telescope=="OTHER", specify name here</description>
     <value></value>
     </param>

     <param type="bool" name="dopb">
     <description>Should we apply the vp/pb to this telescope's data?</description>
     <value>true</value>
     </param>

     <param type="doubleArray" name="coeff">
     <description>Coefficients of even powered terms</description>
     <value>-1</value>
     </param>

     <param type="any" name="maxrad">
     <description>Maximum radial extent of the vp/pb (scales with 1/freq)</description>
     <any type="variant"/>
     <value>0.8deg</value>
     </param>

     <param type="any" name="reffreq">
     <description>Frequency at which maxrad is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="string" name="isthispb">
     <description>Do these parameters describe a PB or a VP?</description>
     <value>PB</value>
     </param>

     <param type="any" name="squintdir">
     <any type="variant"/>
     <description>Offset (Measure) of RR beam from pointing center, azel frame (scales with 1/freq)</description>
     <value></value>
     </param>

     <param type="any" name="squintreffreq">
     <description>Frequency at which the squint is specified</description>
     <any type="variant"/>
     <value>1.0GHz</value>
     </param>

     <param type="bool" name="dosquint">
     <description>Enable the natural beam squint found in the common vp model</description>
     <value>false</value>
     </param>

     <param type="any" name="paincrement">
     <description>Increment in Parallactic Angle for asymmetric (ie, squinted) vp application</description>
     <any type="variant"/>
     <value>720</value>
     </param>

     <param type="bool" name="usesymmetricbeam">
     <description>Not currently used</description>
     <value>false</value>
     </param>
</input>
<returns type="any"><any type="record"/>itemcontainer</returns>
</method>

</tool>

</casaxml>
