<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="uvcontsub" category="modelling">
<shortdescription>Continuum fitting and subtraction in the uv plane</shortdescription>
<description>
A polynomial of the desired order is fit across the specified
channels that define the continuum emission.  The data may be
averaged in time to increase the signal to noise.  This fit
represents a model of the continuum in all channels.

For fitmode='subtract', the fitted continuum spectrum is
subtracted from all channels and the result (presumably only
line emission) is stored in the CORRECTED_DATA.  The
continuum fit is stored in the MODEL_DATA.

For fitmode='model' the continuum model is stored in the
MODEL_DATA; but the CORRECTED_DATA is unaffected.

For fitmode='replace' the continuum model is stored in
the CORRECTED_DATA; this is useful to image the continuum model
result.

</description>
<input>
	<param type="string" name="vis" mustexist="true">
		<description>Name of input visibility file</description>
		<value></value>
	</param>

        <param type="any" name="field">
                <description>Select field using field id(s) or field name(s)</description>
		<any type="variant" limittypes="string stringArray int intArray"/>
                <value type="string"></value>
        </param>

	<param type="string" name="fitspw">
		<description>Spectral window/channel selection for fitting the continuum</description>
		<value></value>
	</param>

	<param type="string" name="spw">
		<description>Spectral window selection for subtraction/export</description>
		<value></value>
	</param>

	<param type="any" name="solint">
		<description>Continuum fit timescale</description>
                <any type="variant"/>
                <value type="string">int</value>
	</param>

	<param type="int" name="fitorder">
		<description>Polynomial order for the fit</description>
		<value>0</value>
	</param>

	<param type="string" name="fitmode">
		<description>Use of continuum fit (subtract,replace,model)</description>
		<value>subtract</value>
		<allowed kind="enum">
		<value>subtract</value>
		<value>replace</value>
		<value>model</value>
		</allowed>
	</param>

	<param type="bool" name="splitdata">
		<description>Split out continuum, continuum-subtracted data</description>
		<value>False</value>
	</param>

</input>
<example>

	
	A polynomial of the desired order is fit to each baseline/time across the
        specified channels that define the continuum emission.  The data may
	be averaged in time to increase the signal to noise.  This fit
	represents a uv-data model of the continuum across all channels.
	
	For fitmode='subtract', the fitted continuum uv spectrum is
	subtracted from all channels and the result (presumably only
	line emission) is stored in the	CORRECTED_DATA.  The
	continuum fit is stored in the MODEL_DATA.

	For fitmode='model' the continuum model is stored in the
	MODEL_DATA; but the CORRECTED_DATA is unaffected.

	For fitmode='replace' the continuum model is stored in
	the CORRECTED_DATA; this is useful to image the continuum model
	result.  You will have to rerun applycal to place the calibrated
        data back in the CORRECTED_DATA

	Keyword arguments:
	vis -- Name of input visibility file
		default: none; example: vis='ngc5921.ms'
        field -- Field selection
                default: field = '' means select all fields
                field = 1 # will get field_id=1 (if you give it an 
                        integer, it will retrieve the source with that index.
                field = '1328+307'  specifies source '1328+307'
		field = '13*' will retrieve '1328+307' and any other fields
		   beginning with '13'
	fitspw -- Selection of spectral windows and channels to use in the
	          fit for the continuum, using general spw syntax
		default: ''=all; example: fitspw='0:5~30;40~55'
	spw -- Optional per spectral window selection of channels from
	       which to subtract the continuum. 
		default: spw='', means subtract from all channels for
		  each spw that had a continuum estimated
	       Also, this specifies which spw/chan will be split
	       out if splitdata=True.
	solint -- Timescale for per-baseline fit (units optional)
		default: 'int' --&gt; no averaging, fit every integration;
		example: solint='10s'  --&gt; average to 10s before fitting
                         10 or '10' --&gt; '10s' (unitless: assumes seconds)
                options: 'int' --&gt; per integration
                         'inf' --&gt; per scan
	fitorder -- Polynomial order for the fit of the continuum
		default: 0 (constant); example: fitorder=1
	fitmode -- Use of the continuum fit model
		default: 'subtract'; example: fitmode='replace'
		Options: 
		'subtract'-store fitted continuum model in MODEL and
		   subtract this continuum from data in CORRECTED to
		   produce line-emission in CORRECTED.
		'model'-store fit continuum model in MODEL, but
		   do not change data in CORRECTED.
		'replace'-replace CORRECTED with continuum mode fit.
	splitdata -- Split out continuum and continuum subtracted line data
		default: 'False'; example: splitdata=True
		The derived continuum data will be placed in: vis.cont
		The continuum subtracted data will be placed in: vis.contsub
                The spw/channels selected are given in spw
        async -- Run task in a separate process (return CASA prompt)
                default: False; example: async=True

</example> 
</task>
</casaxml>
