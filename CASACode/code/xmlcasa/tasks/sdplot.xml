<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">


<!-- This is the param set for sdplot -->

<task type="function" name="sdplot" startup="false" category="single dish">

  <shortdescription>ASAP SD plotting task </shortdescription>

  <description>ASAP SD plotting task
        
        Modified 2008-09-17 KS
        Modified 2008-09-15 TT
        Modified 2008-07-31 TT
        Modified 2008-07-15 KS
        Modified 2008-01-30 TT
        Task Version 2007-03-04 STM
</description>

  <input>

    <param type="string" name="sdfile"  mustexist="true">
    <description>name of input SD dataset</description>
    <value></value>
    </param>

    <param type="any" name="antenna">
            <description>antenna name or id (only effective for MS input)</description>
            <any type="variant" limittype="string int"/>
            <value type="int">0</value>
    </param> 

    <param type="string" name="fluxunit">
	    <description>units for line flux (K,Jy) (''=current)</description>
	    <value></value>
    </param>

    <param type="any" name="telescopeparm" subparam='true'>
	    <description>param of telescope for flux conversion</description>
            <any type='variant' limittype='string doubleArray'/>
	    <value type='string'/>
    </param>

    <param type="string" name="specunit">
	    <description>units for spectral axis (channel,km/s,GHz)</description>
	    <value></value>
	    <allowed kind="enum">
	    <value></value>
	    <value>channel</value>
	    <value>km/s</value>
	    <value>GHz</value>
	    <value>MHz</value>
	    <value>kHz</value>
	    <value>Hz</value>
    </allowed>
    </param>

    <param type="any" name="restfreq">
            <description>rest frequency (float value or string with unit)</description>
            <any type="variant" limittype="string double"/>
            <value type="string"/>
    </param>

    <param type="string" name="frame">
	    <description>frequency reference frame, e.g. LSRK (''=current)</description>
	    <value></value>
    </param>

    <param type="string" name="doppler">
	    <description>doppler convention, e.g. RADIO (''=current)</description>
	    <value></value>
    </param>

    <param type="intArray" name="scanlist">
	    <description>list of scans to use (e.g. [1,2,3,4])</description>
	    <value></value>
    </param>

    <param type="string" name="field">
	    <description>string for selection by source name</description>
	    <value></value>
    </param>

    <param type="intArray" name="iflist">
	    <description>list of IF ids to select (e.g. [0,1])</description>
	    <value></value>
    </param>

    <param type="intArray" name="pollist">
            <description>list of polarization ids to select (e.g. [0,1])</description>
            <value></value>
    </param>

    <param type="bool" name="scanaverage">
            <description>average integs within scans (True,False)</description>
            <value>False</value>
    </param>

    <param type="bool" name="timeaverage">
            <description>average scans over time (True,False)</description>
            <value>False</value>
    </param>

    <param type="string" name="tweight" subparam="true">
            <description>weighting for time averaging</description>
            <value>none</value>
            <allowed kind="enum">
            <value>none</value>
            <value>var</value>
            <value>tsys</value>
            <value>tint</value>
            <value>tintsys</value>
            <value>median</value>
            </allowed>
    </param>

    <param type="bool" name="polaverage">
            <description>average over polarizations (True,False)</description>
            <value>False</value>
    </param>

    <param type="string" name="pweight" subparam="true">
            <value>none</value>
            <allowed kind="enum">
            <value>none</value>
            <value>var</value>
            <value>tsys</value>
            </allowed>
    </param>


    <param type="string" name="kernel">
            <description>type of spectral smoothing</description>
            <value>none</value>
            <allowed kind="enum">
            <value>none</value>
            <value>hanning</value>
            <value>gaussian</value>
            <value>boxcar</value>
            </allowed>
    </param>

    <param type="int" name="kwidth" subparam="true">
            <description>width of spectral kernel in channels</description>
            <value>5</value>
    </param>

    <param type="string" name="plottype">
            <description>type of plot (spectra, totalpower, azel, pointing)</description>
            <value>spectra</value>
            <allowed kind="enum">
            <value>pointing</value>
            <value>azel</value>
            <value>totalpower</value>
            <value>spectra</value>
	    </allowed>
    </param>

    <param type="string" name="stack" subparam="true">
            <description>code for stacking on single plot for spectral plotting</description>
            <value>p</value>
    </param>

    <param type="string" name="panel" subparam="true">
            <description>code for splitting into multiple panels for spectral plotting</description>
            <value>i</value>
    </param>

    <param type="doubleArray" name="flrange" subparam="true">
            <description>range for flux axis of plot for spectral plotting</description>
            <value></value>
    </param>

    <param type="any" name="sprange" subparam="true">
            <description>range for spectral axis of plot</description>
            <any type='variant' limittype='intArray doubleArray'/>
            <value type="doubleArray"></value>
    </param>

    <param type="string" name="linecat" subparam="true">
            <description>control for line catalog plotting for spectral plotting</description>
            <value>none</value>
    </param>

    <param type="double" name="linedop" subparam='true'>
            <description>doppler offset for line catalog plotting (spectral plotting)</description>
            <value>0.0</value>
    </param>

    <param type="string" name="colormap" subparam="true">
            <description>the colours to be used for plot lines</description>
            <value>none</value>
    </param>

    <param type="string" name="linestyles" subparam="true">
            <description>the linestyles to be used for plot lines</description>
            <value>none</value>
    </param>

    <param type="any" name="linewidth" subparam="true">
            <description>width of plotted lines</description>
            <any type='variant' limittype='int double'/>
            <value>1</value>
    </param>

    <param type="bool" name="histogram" subparam='true'>
            <description>plot histogram</description>
            <value>False</value>
    </param>

    <param type="bool" name="header">
	    <description>print header information on the plot</description>
	    <value>True</value>
    </param>

    <param type="int" name="headsize" subparam='true'>
            <description>header fontsize</description>
            <value>9</value>
    </param>

    <param type="bool" name="plotstyle">
	    <description>customise plot settings</description>
	    <value>False</value>
    </param>

    <param type="doubleArray" name="layout" subparam='true'>
            <description>subplot layout in [left, bottom, right, top, horizontal space, vertical space]</description>
            <value type="vector"></value>
    </param>

    <param type="int" name="legendloc" subparam='true'>
            <description>legend location</description>
            <value>1</value>
    </param>

    <param type="string" name="plotfile">
	    <description>file name for hardcopy output</description>
	    <value></value>
    </param>

    <param type="bool" name="overwrite">
            <description>overwrite the output file if already exists</description>
            <value>False</value>
    </param>


    <constraints>
	    <when param="fluxunit">
		<equals value=""/>
		<equals value="K">
			<default param="telescopeparm"><value>""</value></default>
		</equals>
	        <equals value="k">
			<default param="telescopeparm"><value>""</value></default>
	        </equals>
	        <equals value="Jy">
			<default param="telescopeparm"><value>""</value></default>
	        </equals>
	        <equals value="jy">
			<default param="telescopeparm"><value>""</value></default>
	        </equals>
	    </when>
            <when param="kernel">
                <equals value="none"/>
                <equals value="hanning"/>
                <equals value="gaussian">
                        <default param="kwidth"><value>5</value></default>
                </equals>
                <equals value="boxcar">
                        <default param="kwidth"><value>5</value></default>
                </equals>
            </when>
            <when param="plottype">
                <equals value="spectra">
                        <default param="stack"><value type="string">p</value></default>
                        <default param="panel"><value type="string">i</value></default>
                        <default param="flrange"><value type="vector"></value></default>
                        <default param="sprange"><value type="vector"></value></default>
                        <default param="linecat"><value type="string">none</value></default>
                        <default param="linedop"><value>0.0</value></default>
                        <default param="colormap"><value type="string">none</value></default>
                        <default param="linestyles"><value type="string">none</value></default>
                        <default param="linewidth"><value>1</value></default>
                        <default param="histogram"><value>False</value></default>
                </equals>
                <equals value="totalpower"/>
                <equals value="pointing"/>
                <equals value="azel"/>
            </when>

            <when param="timeaverage">
                <equals type="bool" value="False"/>
                <equals type="bool" value="True">
                        <default param="tweight"><value type='string'>none</value></default>
                </equals>
            </when>
            <when param="polaverage">
                <equals type="bool" value="False"/>
                <equals type="bool" value="True">
                        <default param="pweight"><value type='string'>none</value></default>
                </equals>
            </when>

            <when param="header">
                <equals type="bool" value="True">
                        <default param="headsize"><value type="int">9</value></default>
                </equals>
                <equals type="bool" value="False"/>
            </when>

            <when param="plotstyle">
                <equals type="bool" value="False"/>
                <equals type="bool" value="True">
                        <default param="layout"><value type="vector"></value></default>
                        <default param="legendloc"><value type="int">1</value></default>
                </equals>
            </when>


    </constraints>

    </input>

  <returns type="void"/>

  <example>
  Keyword arguments:
        sdfile -- name of input SD dataset
        antenna -- antenna name or id (only effective for MS input). 
        fluxunit -- units for line flux
                options: 'K','Jy',''
                default: '' (keep current fluxunit)
                WARNING: For GBT data, see description below.
            &gt;&gt;&gt; fluxunit expandable parameter
                 telescopeparm -- the telescope characteristics
                        options: (str) name or (list) list of gain info
                        default: '' (none set)
                        example: if telescopeparm='', it tries to get the telescope
                                 name from the data.
                                 Full antenna parameters (diameter,ap.eff.) known
                                 to ASAP are
                                 'ATPKSMB', 'ATPKSHOH', 'ATMOPRA', 'DSS-43',
                                 'CEDUNA','HOBART'. For GBT, it fixes default fluxunit
                                 to 'K' first then convert to a new fluxunit.
                                 telescopeparm=[104.9,0.43] diameter(m), ap.eff.
                                 telescopeparm=[0.743] gain in Jy/K
                                 telescopeparm='FIX' to change default fluxunit
                                 see description below

        specunit -- units for spectral axis
                options: (str) 'channel','km/s','GHz','MHz','kHz','Hz'
                default: '' (=current)
                example: this will be the units for masklist
        restfreq -- rest frequency used for specunit='km/s'
                default: '' (use current setting)
                example: 4.6e10 (float value), '46GHz' (string with unit)
                         Allowed units are 'THz', 'GHz', 'MHz', 'kHz', and 'Hz'
        frame -- frequency frame for spectral axis
                options: (str) 'LSRK','REST','TOPO','LSRD','BARY',
                         'GEO','GALACTO','LGROUP','CMB'
                default: currently set frame in scantable
                WARNING: frame='REST' not yet implemented
        doppler -- doppler mode
                options: (str) 'RADIO','OPTICAL','Z','BETA','GAMMA'
                default: currently set doppler in scantable
        scanlist -- list of scan numbers to process
                default: [] (use all scans)
                example: [21,22,23,24]
                         this selection is in addition to field
                         iflist and pollist
        field -- selection string for selecting scans by name
                default: '' (no name selection)
                example: 'FLS3a*'
                         this selection is in addition to scanlist
                         iflist and pollist
        iflist -- list of IF id numbers to select
                default: [] (use all IFs)
                example: [15]
                         this selection is in addition to scanlist
                         field and pollist
        pollist -- list of polarization id numbers to select
                default: [] (use all polarizations)
                example: [1]
                         this selection is in addition to scanlist,
                         field, and iflist
        scanaverage -- average integs within scans
                options: (bool) True,False
                default: False
        timeaverage -- average times for multiple scan cycles
                options: (bool) True,False
                default: False
                example: if True, this happens after calibration
                &gt;&gt;&gt;timeaverage expandable parameter
                 tweight -- weighting for time average
                         options: 'none'
                                  'var'   (1/var(spec) weighted)
                                  'tsys'  (1/Tsys**2 weighted)
                                  'tint'  (integration time weighted)
                                  'tintsys'  (Tint/Tsys**2)
                                  'median'  ( median averaging)
                         default: 'none'
        polaverage -- average polarizations
                options: (bool) True,False
                default: False
                &gt;&gt;&gt;polaverage expandable parameter
                 pweight -- weighting for polarization average
                         options: 'none'
                                  'var'  (1/var(spec) weighted)
                                  'tsys' (1/Tsys**2 weighted)
        kernel -- type of spectral smoothing
                options: 'hanning','gaussian','boxcar', 'none'
                default: 'none'
                &gt;&gt;&gt;kernel expandable parameter
                 kwidth -- width of spectral smoothing kernel
                         options: (int) in channels
                         default: 5
                         example: 5 or 10 seem to be popular for boxcar
                                  ignored for hanning (fixed at 5 chans)
                                  (0 will turn off gaussian or boxcar)
        plottype -- type of plot
                 options: 'spectra','totalpower','pointing','azel'
                 default: 'spectra'
            &gt;&gt;&gt; plottype expandable parameter
                 stack -- code for stacking on single plot for spectral plotting
                         options: 'p','b','i','t','s' or
                                  'pol', 'beam', 'if', 'time', 'scan'
                         default: 'p'
                         example: maximum of 25 stacked spectra
                                  stack by pol, beam, if, time, scan
                 panel -- code for splitting into multiple panels for spectral plotting
                         options: 'p','b','i','t','s' or
                                  'pol', 'beam', 'if', 'time', 'scan'
                         default: 'i'
                         example: maximum of 25 panels
                                  panel by pol, beam, if, time, scan
                flrange -- range for flux axis of plot for spectral plotting
                        options: (list) [min,max]
                        default: [] (full range)
                        example: flrange=[-0.1,2.0] if 'K'
                                 assumes current fluxunit
                sprange -- range for spectral axis of plot
                        options: (list) [min,max]
                        default: [] (full range)
                        example: sprange=[42.1,42.5] if 'GHz'
                                 assumes current specunit
                linecat -- control for line catalog plotting for spectral plotting
                        options: (str) 'all','none' or by molecule
                        default: 'none' (no lines plotted)
                        example: linecat='SiO' for SiO lines
                                 linecat='*OH' for alcohols
                                 uses sprange to limit catalog
                        WARNING: specunit must be in frequency (*Hz)
                                 to plot from the line catalog!
                                 and must be 'GHz' or 'MHz' to use
                                 sprange to limit catalog
                linedop -- doppler offset for line catalog plotting (spectral plotting)
                        options: (float) doppler velocity (km/s)
                        default: 0.0
                        example: linedop=-30.0
                colormap -- the colours to be used for plot lines. 
                        default: None
                        example: colormap="green red black cyan magenta" (html standard)
                                 colormap="g r k c m" (abbreviation)
                                 colormap="#008000 #00FFFF #FF0090" (RGB tuple)
                                 The plotter will cycle through these colours 
                                 when lines are overlaid (stacking mode).
                linestyles -- the linestyles to be used for plot lines. 
                        default: None
                        example: linestyles="line dashed dotted dashdot dashdotdot dashdashdot". 
                                 The plotter will cycle through these linestyles 
                                 when lines are overlaid (stacking mode). 
                        WARNING: Linestyles can be specified only one color has been set. 
                linewidth -- width of plotted lines. 
                        default: 1
                        example: linewidth=1 (integer)
                                 linewidth=0.75 (double)
                histogram -- plot histogram
                        options: (bool) True, False
                        default: False
        header -- print header information on the plot
                options: (bool) True, False
                default: True
                The header information is printed only on the logger when 
                plottype = 'azel' and 'pointing'. 
            &gt;&gt;&gt; header expandable parameter
                headsize -- header font size
                        options: (int)
                        default: 9
        plotstyle -- customise plot settings
                options: (bool) True, False
                default: True
            &gt;&gt;&gt; plotstyle expandable parameter
                layout -- a list of subplots layout in figure coordinate (0-1), 
                          i.e., fraction of the figure width or height.
                          The order of elements should be:
                          [left, bottom, right, top, horizontal space btw panels,
                          vertical space btw panels]
                legendloc -- legend location on the axes (0-10)
                           options: (integer) 0 -10 
                                    see help of "sd.plotter.set_legend" for 
                                    the detail of location. Note that 0 ('best')
                                    is very slow. 
                           default: 1 ('upper right')
        plotfile -- file name for hardcopy output
                options: (str) filename.eps,.ps,.png
                default: '' (no hardcopy)
                example: 'specplot.eps','specplot.png'
                         Note this autodetects the format from
                         the suffix (.eps,.ps,.png).
        overwrite -- overwrite the output file if already exists
                options: (bool) True,False
                default: False


        DESCRIPTION:

        Task sdplot displays single-dish spectra or total power data.
        It assumes that the spectra have been calibrated.
        It does allow selection of scans, IFs,polarizations, and
        some time and channel averaging/smoothing options also,
        but does not write out this data.

        *** Only apply to 'spectra' plottype ***
        Note that colormap and linestyles cannot be controlled at a time. 
        The 'linestyles' is ignored if both of them are specified. 
        Some plot options, like annotation and changing titles,
        legends, fonts, and the like are not supported in this task.  
        You should use sd.plotter from the ASAP toolkit directly for this.

        This task uses the JPL line catalog as supplied by ASAP.
        If you wish to use a different catalog, or have it plot
        the line IDs from top or bottom (rather than alternating),
        then you will need to explore the sd toolkit also.

        Note that multiple scans and IFs can in principle be handled
        through stacking and paneling, but this is fairly rudimentary
        at present and you have little control of what happens in
        individual panels.  We recommend that you use scanlist, field,
        and iflist to give a single selection for each run.

        Currently, setting specunit='GHz' fixes the x-axis span of
        each IF panel to be the same (an example of the limitations
        of ASAP plotting at present).

        This task adds an additional toolbar to ASAP plotter which
        has three buttons, 'spec value', 'statistics', and 'Quit'. 
        When the 'spec value' button is pressed and activated, you can 
        display a spectral value on the toolbar along with mouse
        movement. Click the LEFT-mouse button over a spectrum to select
        it, and drag mouse in the panel to output the spectral value of
        x-position of mouse cursor. The selection is released when you
        release the mouse button. 
        When 'statistic' button is pressed and activated, you can get
        statistic values of a channel region selected by mouse. Select a
        rectangle region with LEFT/RIGHT-mouse to SELECT/EXCLUDE the
        channel region to calculate statistics for the all spectra
        plotted. The results are printed on the casapy console. 
        Press 'Quit' button to close the plotter. 

        *** other plottype options ***
        Currently most of the parameters are ignored in these modes.

        * plottype='totalpower' is used to plot the total power data.
          and only plot option is amplitude versus data row number.
        * plottype='azel' plots azimuth and elevation tracks of the source.
        * plottype='pointing' plots antenna poinitings.

        ASAP recognizes the data of the "AT" telescopes, but currently
        does not know about the GBT or any other telescope. This task
        does know about GBT. Telescope name is obtained from the data.
        If you wish to change the fluxunit (see below), and telescopeparm='',
        for the AT telescopes it will use internal telescope parameters for
        flux conversion. For GBT, it will use an approximate aperture
        efficiency conversion.  If you give telescopeparm a list ,
        then if the list has a single float it is assumed to
        be the gain in Jy/K, if two or more elements they are assumed
        to be telescope diameter (m) and aperture efficiency
        respectively.

        WARNING: be careful plotting otf data with lots of fields!

        WARNING for the GBT raw SDFITS format data as input:
        Currently, all SDtasks cannot handle GBT raw SDFITS format data
        (in which the data are stored in multiple tables within SDFITS).
        It may be still possible to reduce GBT data after some
        preprocessing (outside CASA) of the raw SDFITS to a SDFITS with
        a single data table or to other data formats handled by SDtasks.


  </example>

</task>

</casaxml>
