<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">


<!-- This is the param set for sdtpimaging -->

<task type="function" name="sdtpimaging" startup="false" category="single dish">

  <shortdescription>SD task: do a simple calibration and imaging for total power data </shortdescription>

  <description>SD task for applying a simple baseline subtraction and do imaging for total power data

        (experimental)
        Task Version 2008-09-14 TT
</description>

  <input>

    <param type="string" name="sdfile"  mustexist="true">
    <description>name of input SD dataset(only MS is allowed for this task)</description>
    <value></value>
    </param>

    <param type="string" name="calmode">
	    <description>SD calibration mode (currently only support none or baseline subtraction )</description>
	    <value>none</value>
	    <allowed kind="enum">
	    <value>baseline</value>
	    <value>none</value>
    </allowed>
    </param>
    <param type="intArray" name="masklist" subparam="true">
	    <description>mask in data row numbers to be included for baseline fitting for each scan</description>
            <value></value>
    </param>

    <param type="int" name="blpoly" subparam="true">
	    <description>polynomial order for the baseline fit</description>
             <value>1</value>
    </param>

    <param type="intArray" name="flaglist">
	    <description>list of scan numbers to flag (e.g. [[1,3], 80])</description>
	    <value></value>
    </param>

    <param type="string" name="antenna">
            <description>antenna name(s) or id(s)</description>
            <value></value>
    </param>

    <param type="string" name="stokes">
            <description>stokes or correlation name (e.g. "I", "XX")</description>
            <value></value>
    </param>

    <param type="bool" name="createimage">
            <description>do imaging?</description>
            <value>False</value>
    </param>

<!-- imaging paramters -->
    <param type="string" name="imagename" subparam="true">
	    <description>output image name</description>
	    <value></value>
    </param>

    <param type="intArray" name="imsize" subparam="true">
            <description>x and y image size in pixels, symmetric for single value</description>
            <value type="vector">
    <value>256</value><value>256</value>
            </value>
    </param>

    <param type="doubleArray" name="cell" units="arcmin" subparam="true">
    <description>x and y cell size. default unit arcmin</description>
    <value type="vector"><value>1.0</value><value>1.0</value></value>
    </param>

    <param type="any" name="phasecenter" subparam="true">
            <description>Image phase center: position or field index</description>
            <any type="variant"/>
            <value type="string"></value>
    </param>


    <param type="string" name="ephemsrcname" subparam="true">
	    <description>ephemeris source name</description>
	    <value></value>
    </param>

    <param type="string" name="pointingcolumn" subparam="true">
	    <description>pointing data column to use</description>
	    <value>direction</value>
	    <allowed kind="enum" ignorecase="True">
	    <value>target</value>
	    <value>pointing_offset</value>
	    <value>source_offset</value>
	    <value>encoder</value>
	    <value>direction</value>
    </allowed>
    </param>

    <param type="string" name ="gridfunction" subparam="true">
            <description>gridding function for imaging ("BOX","SF","PB")</description>
            <value>BOX</value>
            <allowed kind="enum">
                <value>BOX</value>
                <value>PB</value>
                <value>SF</value>
            </allowed>
    </param>

    <param type="int" name="plotlevel">
	    <description>plot results (0=none,1+=some,&lt;0=hardcopy)</description>
	    <value>0</value>
    </param>

    <constraints>
            <when param="calmode">
                <equals value="none"/>
                <equals value="baseline">
                        <default param="masklist"><value type="vector"></value></default>
                        <default param="blpoly"><value type="int">1</value></default>
                </equals>
            </when>
            <when param="createimage">
                <equals type="bool" value="False"/>
                <equals type="bool" value="True">
                        <default param="imagename"><value type="string"></value></default>
                        <default param="imsize"><value type="vector"><value>256</value><value>256</value></value></default>
			<default param="cell"><value type="vector"><value>1</value><value>1</value></value></default>
                        <default param="phasecenter"><value type="string"></value></default>
                        <default param="ephemsrcname"><value type="string"></value></default>
                        <default param="pointingcolumn"><value type="string">direction</value></default>
                        <default param="gridfunction"><value type="string">BOX</value></default>
                </equals>
            </when>
    </constraints>

    </input>

  <returns type="void"/>

  <example>
  Keyword arguments:
        sdfile -- name of input SD (MS) dataset
        calmode -- calibration mode (currently only baseline subtraction)
                options: 'baseline','none'
                default: 'none'
                example: choose mode 'none' if you have
                         already calibrated and want to do
                         plotting nd/or imaging 
  &gt;&gt;&gt; calmode='baseline' expandable parameters
               masklist -- mask in numbers of rows from each edge of each scan to be included for baseline fitting
                 default: none
                 example: [30,30] or [30] 
                          used first 30 rows and last 30 rows of each scan for the baseline 
               blpoly -- polynomial order for the baseline fit
                 default: 1
        flaglist -- list of scan numbers to flag (ranges can be accepted)  
                default: [] (use all scans)
                example: [[0,3],80]
                         flag the scan range [0,3] = [0,1,2,3] and scan 80 
        antenna -- select data based on antenna name(s) or id(s) in string
                default: '' (use all antennas)
                example: '0,1', 'DV01'
                WARNING: currently baseline subtraction properly 
                         only one of the antennas.
        stokes -- select data based on stokes or polarization type 
                default: '' (use all polarizations)
                example: 'XX'
        createimage -- do imaging? 
                default: False 
  &gt;&gt;&gt; createimage=True expandable parameters
               imagename -- output image name
                 default: none
                 example: 'mySDimage.im'
               imsize -- x and y image size in pixels, symmetric for single value
                 default: [256,256]
                 example: imsize=200 (equivalent to [200,200])
               cell -- x and y cell size. default unit arcmin
                 default: '1.0arcmin'
                 example: cell=['0.2arcmin, 0.2arcmin']
                          cell='0.2arcmin' (equivalent to example above)
               phasecenter -- image phase center: direction measure or fieldid 
                 default: 0
                 example: 'J2000 13h44m00 -17d02m00', 'AZEL -123d48m29 15d41m41'
               ephemsrcname -- ephemeris source name to proper shifting to center on the moving source
                               for imaging
                 default: ''
                          if the source name in the data matches one of the known solar objects by
                          the system, this task automatically set the source name. 
                 example: 'moon' 
               pointingcolumn -- pointing data column to use
                 option: 'direction', 'target', 'pointing_offset', 'source_offset', 'encoder' 
                 default: 'direction'
               gridfunction -- gridding function for imaging
                 options: 'BOX' (Box-car), 'SF' (Spheroidal), 'PB' (Primary-beam)
                 default: 'BOX'
                 example: 'SF'
        plotlevel -- control for plotting of results
                options: (int) 0=none, 1=some, 2=more, &lt;0=hardcopy
                default: 0 (no plotting)
                example: plotlevel&lt;0 as abs(plotlevel), e.g.
                         -1: hardcopy plot (will be named &lt;sdfile&gt;_scans.eps)
                          1: plot raw data, calibrated data (for calmode='baseline)
                             plot raw or if exist calibrated data (for calmode='none')
                          2: plot raw data, progressively display baseline fitting for each scan,
                             and final calibrated data (for calmode='baseline')  


        DESCRIPTION:

        Task sdtpimaging performs data selection, calibration, and imaging for single-dish
        totalpower raster scan data.  This is a still experimental task made to work 
        mostly for the data taken at the ALMA Testing Facility (ATF) or OSF. Currently, 
        this task directly accesses the Measurement Set data only because of the data access 
        efficiency. So it differs from other single-dish tasks that mostly operate on the 
        ASAP scantable data format.  By setting calmode='none', one can run sdtpimaging to 
        plot the data (raw or calibrated, if exists) and further imaging by setting 
        createimage=True. 
        The calibration available at this moment is just a simple baseline subtraction for
        each scan. The fitted regions set by masklist are the common for all the scans. 
        Selection of the antennas can be made by setting antennaid(s) or antenna name(s)
        in string (e.g. '0', '0,1', 'DV01',etc.). 
        For baseline subtraction, it currently works properly for a single antenna selection. 
        So a separate sdtpimaging task needs to be ran for each antenna.
        It currently assumes that the data has a single spw(=0) and fieldid(=0).
        By setting flaglist, one can set flag by scan numbers to be excluded from imaging.
        (Note: 'scan numbers' are determined from state id and related to SUB_SCAN column 
        in STATE subtable and not to SCAN_NUMBER in MS.) 
        The selection of polarizations can be made by specifying the polarization name in stokes, 
        such as 'XX' or 'YY' for linear polarizations. For example, with createimage=True,
        stokes='XXYY' will produces an image cube with each plane contains the image of one of
        the polarizations while stokes='' or stokes='I' will produces a 'total intensity' or 
        Stokes I image. 
        Among the imaging sub-parameters, ephemsrcname is used to set the name of 
        a moving source such as planets to produce a stationary image (can be omitted), and 
        pointingcolumn is used to specify which pointing data column to use for imaging. 
  </example>

</task>

</casaxml>
